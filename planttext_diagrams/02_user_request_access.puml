@startuml
title JIT Access - User Requests Access
actor User
participant Browser
participant "Flask App" as App
database "SQL Server" as DB

User -> Browser: Open /user/request
Browser -> App: GET /user/request
App -> DB: sp_Role_ListRequestable(UserId)
DB --> App: Requestable roles
App --> Browser: Render request form

User -> Browser: Submit form (roles, duration, justification, ticket)
Browser -> App: POST /user/request
App -> App: Validate roles + duration
alt Invalid or empty roles
  App -> DB: sp_Role_ListRequestable(UserId)
  DB --> App: Requestable roles
  App --> Browser: Render form with error
else Valid roles
  App -> DB: sp_Request_Create(UserId, RoleIds, Duration, Justification, TicketRef)
  DB --> App: OK
  App --> Browser: 302 Redirect /user/dashboard
end
@enduml
